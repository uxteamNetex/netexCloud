var onlineColor = "#1AAAE3";
var virtualColor = "#f2ac46";
var classroomColor = "#8dd38d";
var eventsOnline = [
    {
        title: 'Visual Studio 2008 Introduction',
        course_name: 'Visual Studio 2008: Windows Workflow Foundation',
        color: onlineColor,
        start: '2017-12-27',
        end: '2017-12-27',
        type: 'Online', 
        ubication: 'Room C - Madrid Office',
    },
    {
        title: 'Visual Studio 2008 Introduction',
        course_name: 'Visual Studio 2008: Windows Workflow Foundation',
        color: onlineColor,
        start: '2017-12-26T09:00:00',
        end: '2017-12-26T10:00:00',
        type: 'Online', 
        ubication: 'Room C - Madrid Office',
    },  
    {
        title: 'Online Course of Visual Studio 2008: Windows Workflow Foundation',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-15T11:00:00',
        end: '2017-12-15T12:00:00',
        type: 'Online',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: onlineColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
         
];
var eventsVirtual =[
        {
            title: 'JavaScript, HTML5 y CSS3',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-15',
            end: '2017-12-15',
            type: 'Virtual',
            ubication: 'Sala A',                   
        },
        {
            title: 'TWO-JavaScript, HTML5 y CSS3',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-10',
            end: '2017-12-17',
            type: 'Virtual',
            ubication: 'Sala A',                   
        },
        {
            title: 'Evento1 - Course of Visual Studio 2008: Windows Workflow Foundation',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-10T09:00:00',
            end: '2017-12-10T12:00:00',
            type: 'Virtual',
            ubication: 'Sala D',
        },
        {
            title: 'Evento 2',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-10T08:00:00',
            end: '2017-12-10T10:00:00',
            type: 'Virtual',
            ubication: 'Sala D',
        },
        {
            title: 'Evento 3',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-10T12:00:00',
            end: '2017-12-10T12:30:00',
            type: 'Virtual',
            ubication: 'Sala D',
        },
        {
            title: 'Evento 4',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-10T07:00:00',
            end: '2017-12-10T08:00:00',
            type: 'Virtual',
            ubication: 'Sala D',
        },
        {
            title: 'Evento 5',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-10T13:00:00',
            end: '2017-12-10T16:00:00',
            type: 'Virtual',
            ubication: 'Sala D',
        },
        {
            title: 'Evento 6',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-10',
            end: '2017-12-10',
            type: 'Virtual',
            ubication: 'Sala D',
        },
        {
            title: 'Evento 7',
            course_name: 'Lorem ipsum..',
            color: virtualColor,
            start: '2017-12-10',
            end: '2017-12-10',
            type: 'Virtual',
            ubication: 'Sala D',
        },
        {
            title: 'Netex Formación FrontEnd',
            course_name: 'Una maravillosa clase magistral',
            color: virtualColor,
            start: '2017-12-07',
            end: '2017-12-08',
            type: 'Virtual',
            ubication: 'Sala D',
        }
];
var eventsClassroom = [
    {
        title: 'Visual Studio 2008 Introduction',
        course_name: 'Visual Studio 2008: Windows Workflow Foundation',
        color: classroomColor,
        start: '2017-12-20',
        end: '2017-12-20',
        type: 'Online', 
        ubication: 'Room C - Madrid Office',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: classroomColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: classroomColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: classroomColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: classroomColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: classroomColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Evento 7',
        course_name: 'Lorem ipsum..',
        color: classroomColor,
        start: '2017-12-10',
        end: '2017-12-10',
        type: 'Virtual',
        ubication: 'Sala D',
    },
    {
        title: 'Visual Studio 2008 Introduction',
        course_name: 'Course of Visual Studio 2008: Windows Workflow Foundation',
        color: classroomColor,
        start: '2017-12-21',
        end: '2017-12-26',
        type: 'Online', 
        ubication: 'Room C - Madrid Office',
    }, 
    {
        title: 'Online Course of Visual Studio 2008: Windows Workflow Foundation',
        course_name: 'Lorem ipsum..',
        color: classroomColor,
        start: '2017-12-15T12:00:00',
        end: '2017-12-15T13:00:00',
        type: 'Online',
        ubication: 'Sala D',
    },      
];
var eventsAll = eventsVirtual.concat(eventsOnline, eventsClassroom);

// FullCalendar code
var FC = $.fullCalendar; // a reference to FullCalendar's root namespace
var View = FC.View;      // the class that all views must inherit from
var CustomView;          // our subclass

CustomView = View.extend({ // make a subclass of View

    initialize: function () {
        // called once when the view is instantiated, when the user switches to the view.
        // initialize member variables or do other setup tasks.
    },
    render: function () {
        // responsible for displaying the skeleton of the view within the already-defined
        // this.el, a jQuery element.
    },
    setHeight: function (height, isAuto) {
        // responsible for adjusting the pixel-height of the view. if isAuto is true, the
        // view may be its natural height, and `height` becomes merely a suggestion.
    },
    renderEvents: function (events) {
        // reponsible for rendering the given Event Objects

        //Nuevo diseño de la vista de Agenda
        console.dir(events);    
        var html = "";          
        html += '<table>';
        html += '<thead><tr>';
        html += '<th class="col-lg-2">día</th>';
        html += '<th class="col-lg-2">duración</th>';
        html += '<th class="col-lg-8">evento</th>';
        html += '</tr></thead>';
        html += '<tbody class="fc-body">';
       
       for(var index in events){
           var event = events[index];
           var start = moment(event.start).format('dddd DD/MM');
           var end = moment(event.end).format('dddd DD/MM');
           var startTime = moment(event.start).format('HH:mm');
           var endTime = moment(event.end).format('HH:mm');
           var duration = startTime+" - "+endTime;
           if(start == end && duration == "00:00 - 23:59"){
               duration = "Todo el día";
           }
           
           html += "<tr>";
           html += '<td><a href="#">'+start+'</a></td>';
           html += "<td>"+duration+"</td>";
           html += "<td>"+event.title+"</td>";                              
           html += "</tr>";
       }
       
        html += ' ';
        html += '</tbody>';
        html += '</table>';
                   
        $('.fc-agendaNext-view').html(html);     
    },
    destroyEvents: function () {
        // responsible for undoing everything in renderEvents
    },
    renderSelection: function (range) {
        // accepts a {start,end} object made of Moments, and must render the selection
    },
    destroySelection: function () {
        // responsible for undoing everything in renderSelection
    }

});

// call this what you like, for this example it's just called 'custom'
FC.views.agendaNext = CustomView; // register our class with the view system

$(document).ready(function() {               
    $('#minicalendar').datetimepicker({
            inline: true,
            locale: 'en',
            viewMode: 'days',
            format: 'DD/MM/YYYY',               
    }).on("dp.change", function (e) {
        $('#calendar').fullCalendar('gotoDate', e.date);
        //Eliminar popovers abiertos
        $(".popover").hide(); 
        $(".popover").removeClass('in');  
        //Activate popovers events
        $('[data-toggle="popover"]').popover({
            html:true,
            //Importante para añadir diseño al popover
            placement: function(context, src) {
                $(context).addClass('popover-event-wrapper-central');
                return 'bottom';
            },            
        });
    });
    
    $('#calendar').fullCalendar({
        height: 'auto',
        lazyFetching: false,
        defaultDate: '2017-12-18',
        minTime: "07:00:00",
        maxTime: "21:00:00",
        timeFormat: 'HH:mm',
        editable: true,
        eventLimit: true, // allow "more" link when too many events
        lang: "es",
        locale: "es",
        header: {
            left: 'title,prev,next',
            center: '',
            right: 'today,agendaDay,agendaWeek,month,agendaNext,year'
        },
        columnFormat: {
            week: 'ddd D'
        },
        views : {
            agendaDay : {
                displayEventTime: false
            },
            agendaWeek : {
                displayEventTime: false
            },
            month :{
                displayEventTime: false,
                eventLimit: 6
            },
            agendaNext : {
                buttonText: 'Schedule'
            },
            year: {
                buttonText: 'Year',
                type: 'timelineYear',
                slotDuration: { months: 1 },
            },
        },
        eventRender: function(event, element, view) {               
           var start = moment(event.start).format('DD/MM/YYYY HH:mm')
           var end = moment(event.end).format('DD/MM/YYYY HH:mm')
           
            //Parametros del popover:
            function getPopoverRowEvent(title,data){
                var popoverContent = '<div class="row">';
                    popoverContent += '<div class="col-lg-5"><label>'+title+':</label></div>';
                    popoverContent += '<div class="col-lg-7"><span>'+data+'</span></div>';
                    popoverContent += '</div>';
                return popoverContent;
            }
            function getPopoverButtonEvent(){
                var popoverContent = '<div class="row">';
                    popoverContent += '<div class="col-lg-12 separation-all-reset right-align"><a href="#" class="btn btn-link separation-all-reset">VIEW COURSE</a></div>';
                    popoverContent += '</div>';
                return popoverContent;
            }

            //Construimos el contenido del popover:
            var popoverContent = '';
            popoverContent += '<div class="popover-event">';               
            popoverContent += getPopoverRowEvent("Event name",event.title);
            popoverContent += getPopoverRowEvent("Course name",event.course_name);
            popoverContent += getPopoverRowEvent("Start date",start);
            popoverContent += getPopoverRowEvent("End date",end); 
            popoverContent += getPopoverRowEvent("Type",event.type); 
            popoverContent += getPopoverRowEvent("Location",event.ubication);  
            popoverContent += getPopoverButtonEvent();                                                                    
            popoverContent += "</div>";
           
            // Añadimos atributos necesarios para el popover bottom de cada evento:            
            element.attr("data-container","body");
            element.attr("data-toggle","popover");
            element.attr("data-placement","bottom");   
            element.attr("data-content",popoverContent);                                      
        },
        events: eventsAll,

        select: function (start, end, jsEvent){
            popoverElement = $(jsEvent.target);
            $(jsEvent.target).popover({
                content: function(){
                    return $("#popoverContent").html();
                },
                html: 'true',
                trigger: 'click',
                container: 'body'
            }).popover('show');
        },

        eventClick: function(calEvent, jsEvent, view) {
            popoverElement = $(jsEvent.currentTarget);             
        }
    });
    
    //Activate popovers events
    $('[data-toggle="popover"]').popover({
        html:true,
        //Importante para añadir diseño al popover
        placement: function(context, src) {
            $(context).addClass('popover-event-wrapper-central');
            return 'bottom';
        },            
    }); 

    //Al clicar en el boton de cambio de vista
    $('.fc-button').click(function() {
        //Eliminar popovers abiertos
        $(".popover").hide(); 
        $(".popover").removeClass('in');  

        //Activate popovers events
        $('[data-toggle="popover"]').popover({
            html:true,
            //Importante para añadir diseño al popover
            placement: function(context, src) {
                $(context).addClass('popover-event-wrapper-central');
                return 'bottom';
            },            
        });          
    }); 
    //Al redimensionar la pantalla
    $( window ).resize(function() {
        //Eliminar popovers abiertos
        $(".popover").hide();
        $(".popover").removeClass('in');  
    });

});
