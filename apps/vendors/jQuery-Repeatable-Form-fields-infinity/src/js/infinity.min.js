/**************************************************\
|* Script Author: Djordje Jocic                   *|
|* Script Year: 2016                              *|
|* Script Version: 1.0.1                          *|
|* Script License: MIT License (MIT)              *|
|* ============================================== *|
|* Official Website: http://www.djordjejocic.com/ *|
|* ============================================== *|
|* Permission is hereby granted, free of charge,  *|
|* to any person obtaining a copy of this         *|
|* software and associated documentation files    *|
|* (the "Software"), to deal in the Software      *|
|* without restriction, including without         *|
|* limitation the rights to use, copy, modify,    *|
|* merge, publish, distribute, sublicense, and/or *|
|* sell copies of the Software, and to permit     *|
|* persons to whom the Software is furnished to   *|
|* do so, subject to the following conditions:    *|
|* ---------------------------------------------- *|
|* The above copyright notice and this permission *|
|* notice shall be included in all copies or      *|
|* substantial portions of the Software.          *|
|* ---------------------------------------------- *|
|* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT      *|
|* WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,      *|
|* INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF *|
|* MERCHANTABILITY, FITNESS FOR A PARTICULAR      *|
|* PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL *|
|* THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR *|
|* ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER *|
|* IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,   *|
|* RISING FROM, OUT OF OR IN CONNECTION WITH THE  *|
|* SOFTWARE OR THE USE OR OTHER DEALINGS IN THE   *|
|* SOFTWARE.                                      *|
\**************************************************/

function InfinityRenderer(){this.addHeader=function(b,c){var a="";$.each(c.fields,function(e,f){a+="<div class='infinity-col-"+f.size+"'>"+f.title+"</div>"});a+="<div class='infinity-clear'></div>";var d="<div class='infinity-header'><div class='input-column infinity-col-"+c.inputs.size+" infinity-"+c.inputs.align+"'>"+a+"</div><div class='options-column infinity-col-"+c.options.size+" infinity-"+c.options.align+"'>"+c.options.title+"</div><div class='infinity-clear'></div></div>";b.append(d)};this.addRow=function(b,d,e){var f=this;var a="";$.each(e.fields,function(h,i){a+="<div class='infinity-col-"+i.size+"'><div class='infinity-input-wrapper'>"+f.createInput(i)+"</div></div>"});a+="<div class='infinity-clear'></div>";var c="<a class='infinity-btn infinity-btn-add' title='Add' href='#'></a><a class='infinity-btn infinity-btn-remove' title='Remove' href='#'></a><div cass='infinity-clear'></div>";var g="<div class='infinity-row'><div class='input-column infinity-col-"+e.inputs.size+" infinity-"+e.inputs.align+"'>"+a+"</div><div class='options-column infinity-col-"+e.options.size+" infinity-"+e.options.align+"'>"+c+"</div><div class='infinity-clear'></div></div>";d.children().eq(b).after(g)};this.createInput=function(b){if(b.type==="textarea"){return"<textarea class='infinity-object infinity-textarea'></textarea>"}else{if(b.type==="select"){var a="";$.each(b.options,function(c,d){a+="<option value='"+d.value+"'>"+d.text+"</option>"});return"<select class='infinity-object'>"+a+"</select>"}}return"<input class='infinity-object infinity-input' type='text' />"};this.handleValues=function(a,b){var c=this;$.each(b.values,function(e,d){if(!(d instanceof Array)){d=[d]}if(e>0){c.addRow(e,a,b)}$.each(d,function(f,g){a.children(".infinity-row").eq(e).find(".infinity-object").eq(f).val(g)})})};this.handleObjects=function(a,b){a.find(".infinity-row").each(function(d,c){$(this).find(".infinity-object").each(function(e,f){var g=b.inputs.id+"["+d+"]["+e+"]";$(this).attr("name",g)})})}}function InfinityParser(){this.toTXT=function(c){var a="";var b="";c.find(".infinity-row").each(function(e,d){b="";$(this).find(".infinity-object").each(function(f,g){b+=$(this).val()+" "});a+=b.trim()+"\n"});return a};this.toJSON=function(b){var a=[];var c=[];b.find(".infinity-row").each(function(e,d){c=[];$(this).find(".infinity-object").each(function(f,g){c.push($(this).val())});if(c.length===1){c=c[0]}a.push(c)});return JSON.stringify(a)};this.toXML=function(c){var a="<xml>";var d=[];var b=null;c.find(".infinity-row").each(function(f,e){b=$(this).find(".infinity-object");d="<row-"+(f+1)+">";$.each(b,function(g,h){if(b.length===1){d+=$(this).val()}else{d+="<col-"+(g+1)+">"+$(this).val()+"</col-"+(g+1)+">"}});d+="</row-"+(f+1)+">";a+=d});return a+"</xml>"}}(function(a){a.fn.infinityCore={renderer:new InfinityRenderer(),parser:new InfinityParser()};a.fn.infinity=function(d){var c=a(this);var b=a(this).data("infinitySettings");if(typeof b==="undefined"){if(typeof d==="undefined"){d={}}if(typeof d.fields==="undefined"){d.fields=[{title:"Input",type:"input",size:"12"}]}if(typeof d.values==="undefined"){d.values=[]}if(typeof d.inputs==="undefined"){d.inputs={id:"infinity",align:"left"}}if(typeof d.options==="undefined"){d.options={title:"Options",size:"3",align:"left"}}d.inputs.size=12-d.options.size;c.data("infinitySettings",d);b=d}if(typeof b.infinityInit==="undefined"){a.fn.infinityCore.renderer.addHeader(c,b);a.fn.infinityCore.renderer.addRow(0,c,b);a.fn.infinityCore.renderer.handleValues(c,b);a.fn.infinityCore.renderer.handleObjects(c,b);c.on("click",".infinity-btn-add",function(g){var f=a(this).parent().parent().index();a.fn.infinityCore.renderer.addRow(f,c,b);a.fn.infinityCore.renderer.handleObjects(c,d);g.preventDefault()});c.on("click",".infinity-btn-remove",function(h){var i=a(this).parent().parent();var g=i.parent();var f=g.children(".infinity-row").length;if(f>1){i.remove()}a.fn.infinityCore.renderer.handleObjects(c,d);h.preventDefault()});b.infinityInit=true;c.data("infinitySettings",b)}};a.fn.infinityParse=function(c,e){var d=a(this);var b=a(this).data("infinitySettings");if(typeof e==="undefined"){if(c==="txt"){return a.fn.infinityCore.parser.toTXT(d)}else{if(c==="json"){return a.fn.infinityCore.parser.toJSON(d)}else{if(c=="xml"){return a.fn.infinityCore.parser.toXML(d)}}}return a.fn.infinityCore.parser.toTXT(d)}else{return e}}}(jQuery));
